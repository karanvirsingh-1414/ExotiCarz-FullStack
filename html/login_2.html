<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Exoticarz | Get started</title>
  <link rel="stylesheet" href="../css/login_2.css">
  <link rel="icon" href="images/logo.jpg">

</head>

<body>
  <script>localStorage.removeItem('currentUser');</script>
  <img src="../images/logo-removebg.png" width="20%" class="top_logo"></img>
  <div class="hero">
    <video autoplay loop muted plays-inline class="back-video">
      <source src="../images/ok.mp4">
    </video>
  </div>

  <div class="wrapper">
    <div class="title-text">
      <div class="title login">Get Started Here</div>
      <div class="title signup">Signup Here</div>
    </div>
    <div class="form-container">
      <div class="slide-controls">
        <input type="radio" name="slide" id="login" checked>
        <input type="radio" name="slide" id="signup">
        <label for="login" class="slide login">Login</label>
        <label for="signup" class="slide signup">Signup</label>
        <div class="slider-tab"></div>
      </div>
      <div class="form-inner">

        <form id="loginForm" class="login">
          <div class="field">
            <input type="text" name="email" placeholder="Email Address" required>
          </div>
          <div class="field">
            <input type="password" name="password" placeholder="Password" required>
          </div>
          <div class="pass-link"><a href="#">Forgot password?</a></div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="Login">
          </div>
        </form>

        <form id="signupForm" class="signup">
          <div class="field">
            <input type="text" name="email" placeholder="Email Address" required>
          </div>
          <div class="field">
            <input type="password" name="password" placeholder="Password" required>
          </div>
          <div class="field">
            <input type="password" name="confirmPassword" placeholder="Confirm password" required>
          </div>
          <div class="field btn">
            <div class="btn-layer"></div>
            <input type="submit" value="Signup">
          </div>
        </form>

      </div>
    </div>
  </div>





  <script>
    const loginForm = document.querySelector("#loginForm");
    const signupForm = document.querySelector("#signupForm");
    const loginBtn = document.querySelector("label.login");
    const signupBtn = document.querySelector("label.signup");
    const loginText = document.querySelector(".title-text .login");
    const signupText = document.querySelector(".title-text .signup");

    signupBtn.onclick = (() => {
      loginForm.style.marginLeft = "-50%";
      loginText.style.marginLeft = "-50%";
    });
    loginBtn.onclick = (() => {
      loginForm.style.marginLeft = "0%";
      loginText.style.marginLeft = "0%";
    });

    signupText.onclick = (() => {
      signupBtn.click();
      return false;
    });
    loginText.onclick = (() => {
      loginBtn.click();
      return false;
    });

    // LOGIN FORM VALIDATION
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = loginForm.querySelector('input[name="email"]').value;
      const password = loginForm.querySelector('input[name="password"]').value;

      if (email === "" || password === "") {
        alert("Please fill in all fields.");
        return;
      }

      try {
        // CALL BACKEND API
        const response = await fetch('http://localhost:3000/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
          alert("Login Successful! Welcome back.");
          // Store user in localstorage for dashboard usage if needed
          localStorage.setItem('currentUser', JSON.stringify(data.user));
          window.location.href = "dashboard.html";
        } else {
          alert("Login Failed: " + data.message);
        }

      } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong. Is the server running?");
      }
    });

    // SIGNUP FORM VALIDATION
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = signupForm.querySelector('input[name="email"]').value;
      const password = signupForm.querySelector('input[name="password"]').value;
      const confirmPassword = signupForm.querySelector('input[name="confirmPassword"]').value;

      if (email === "" || password === "" || confirmPassword === "") {
        alert("Please fill in all fields.");
        return;
      }

      if (password !== confirmPassword) {
        alert("Passwords do not match!");
        return;
      }

      if (password.length < 6) {
        alert("Password must be at least 6 characters long.");
        return;
      }

      try {
        // CALL BACKEND API
        const response = await fetch('http://localhost:3000/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
          alert("Account Created Successfully! Please login with your new credentials.");
          // Switch to Login Tab
          loginBtn.click();
          signupForm.reset();
        } else {
          alert("Signup Failed: " + data.message);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong. Is the server running?");
      }
    });
  </script>

</body>

</html>